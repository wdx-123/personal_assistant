I have analyzed your requirements and the existing codebase. Here is the implementation plan to add the User Settings interfaces and the image category update logic.

### 1. Define Request DTOs

File: `internal/model/dto/request/userReq.go`
Add the following structures to match the JSON definition:

* `UpdateProfileReq`: `username`, `signature`, `avatar`

* `ChangePhoneReq`: `password`, `new_phone`, `captcha`, `captcha_id`

* `ChangePasswordReq`: `old_password`, `new_password`

### 2. Enhance Image Repository

File: `internal/repository/interfaces/imageRepository.go` & `internal/repository/system/imageRepo.go`

* Add `UpdateCategoryByURL(ctx, url, category)` method.

* This allows updating the image category to `consts.CatAvatar` when a user sets their avatar.

### 3. Update User Service

File: `internal/service/system/userSvc.go`

* Inject `ImageRepository` into `UserService`.

* Implement `UpdateProfile`:

  * Update user info.

  * **Crucial**: If `Avatar` is updated, call `imageRepo.UpdateCategoryByURL(url, consts.CatAvatar)` to mark the image as an avatar.

* Implement `ChangePhone`:

  * Verify old password.

  * Verify new phone captcha.

  * Update phone number.

* Implement `ChangePassword`:

  * Verify old password.

  * Hash and set new password.

### 4. Implement User Controller

File: `internal/controller/system/userCtrl.go`

* Add `UpdateProfile`, `ChangePhone`, `ChangePassword` methods.

* Bind JSON requests and call the corresponding service methods.

### 5. Register Routes

File: `internal/router/system/userRouter.go`

* Register the new `PUT` routes under the `user` group.

I will proceed with these changes upon your confirmation.
